{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container py-5">

  <h2 class="mb-4">Checkout</h2>

  <form method="POST">
    {% csrf_token %}
    <div class="row">

      <!-- LEFT SIDE: BILLING -->
      <div class="col-lg-8">

        <!-- Saved Address -->
        <label class="mt-3 font-weight-bold">Saved Address</label>
        <select class="form-control" name="address">
          <option value="">-- Use new address --</option>
          {% for addr in addresses %}
            <option value="{{ addr.id }}">{{ addr.locality }}, {{ addr.city }}, {{ addr.state }}</option>
          {% endfor %}
        </select>

        <hr>

        <!-- New Address -->
        <h5>New Address</h5>
        <div class="row">
          <div class="col-lg-6 form-group">
            <label>Locality</label>
            <input type="text" name="locality" class="form-control">
          </div>

          <div class="col-lg-6 form-group">
            <label>City</label>
            <input type="text" name="city" class="form-control">
          </div>

          <div class="col-lg-6 form-group">
            <label>State</label>
            <input type="text" name="state" class="form-control">
          </div>
        </div>

      </div>

      <!-- RIGHT SIDE: ORDER SUMMARY -->
      <div class="col-lg-4">
        <div class="card p-3 bg-light">

          <h4>Your Order</h4>
          <ul class="list-group mb-3">
            {% for item in cart_items %}
            <li class="list-group-item d-flex justify-content-between">
              <span>{{ item.product.name }}</span>
              <strong>${{ item.line_total }}</strong>
            </li>
            {% endfor %}

            <li class="list-group-item d-flex justify-content-between">
              <strong>Total</strong>
              <strong>${{ total_amount }}</strong>
            </li>
          </ul>

          <h5>Payment Method</h5>

          <div class="form-check">
            <input class="form-check-input" type="radio" name="payment_method" value="COD" checked>
            <label class="form-check-label">Cash on Delivery</label>
          </div>

          <div class="form-check mt-2">
            <input class="form-check-input" type="radio" name="payment_method" value="QR">
            <label class="form-check-label">Pay by QR Code</label>
          </div>

          <!-- QR PREVIEW -->
          <div id="qr-box" style="display:none" class="text-center mt-3">
            <p>Scan to pay</p>
            <img src="{% static 'img/KHQR.jpg' %}" width="200" class="border p-2">
          </div>

          <button class="btn btn-dark btn-block mt-4">Place Order</button>

        </div>
      </div>

    </div>
  </form>

</div>

<script>
  const qrBox = document.getElementById('qr-box');
  const radios = document.querySelectorAll('input[name="payment_method"]');

  radios.forEach(radio => {
    radio.addEventListener('change', () => {
      qrBox.style.display = radio.value === 'QR' ? 'block' : 'none';
    });
  });
</script>

{% endblock %}
