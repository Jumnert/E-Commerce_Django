{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container">
  <!-- HERO SECTION -->
  <section class="py-5 bg-light">
    <div class="container">
      <div class="row px-4 px-lg-5 py-lg-4 align-items-center">
        <div class="col-lg-6">
          <h1 class="h2 text-uppercase mb-0">Checkout</h1>
        </div>
        <div class="col-lg-6 text-lg-right">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb justify-content-lg-end mb-0 px-0">
              <li class="breadcrumb-item"><a href="{% url 'store:home' %}">Home</a></li>
              <li class="breadcrumb-item"><a href="{% url 'store:cart' %}">Cart</a></li>
              <li class="breadcrumb-item active" aria-current="page">Checkout</li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </section>

  <section class="py-5">
    <div class="row">
      <!-- BILLING FORM -->
      <div class="col-lg-8">
        <h2 class="h5 text-uppercase mb-4">Billing details</h2>
        <form method="POST" action="{% url 'store:checkout' %}">
          {% csrf_token %}

          <!-- Select saved address -->
          <div class="form-group">
            <label for="address">Select a saved address</label>
            <select class="form-control" name="address">
              <option value="">-- Or enter a new address below --</option>
              {% for addr in addresses %}
                <option value="{{ addr.id }}">{{ addr.full_address }}</option>
              {% empty %}
                <option value="">No saved addresses. Please enter a new one below.</option>
              {% endfor %}
            </select>
          </div>

          <h5 class="mt-4">Or enter a new billing address</h5>
          <div class="row">
            <div class="col-lg-6 form-group">
              <label for="first_name">First name</label>
              <input type="text" name="first_name" class="form-control" placeholder="First name">
            </div>
            <div class="col-lg-6 form-group">
              <label for="last_name">Last name</label>
              <input type="text" name="last_name" class="form-control" placeholder="Last name">
            </div>
            <div class="col-lg-12 form-group">
              <label for="address1">Address</label>
              <input type="text" name="address1" class="form-control" placeholder="House number and street">
            </div>
            <div class="col-lg-6 form-group">
              <label for="city">City</label>
              <input type="text" name="city" class="form-control" placeholder="City">
            </div>
            <div class="col-lg-6 form-group">
              <label for="state">State</label>
              <input type="text" name="state" class="form-control" placeholder="State">
            </div>
            <div class="col-lg-6 form-group">
              <label for="country">Country</label>
              <input type="text" name="country" class="form-control" placeholder="Country">
            </div>
          </div>

          <!-- Submit button -->
          <button type="submit" class="btn btn-dark mt-3">Place order</button>
        </form>
      </div>

      <!-- ORDER SUMMARY + PAYMENT METHOD -->
      <div class="col-lg-4">
        <div class="card border-0 rounded-0 p-lg-4 bg-light">
          <div class="card-body">
            <h5 class="text-uppercase mb-4">Your order</h5>
            <ul class="list-unstyled mb-0">
              {% for item in cart_items %}
                <li class="d-flex align-items-center justify-content-between">
                  <strong class="small font-weight-bold">{{ item.product.name }}</strong>
                  <span class="text-muted small">${{ item.line_total }}</span>
                </li>
                <li class="border-bottom my-2"></li>
              {% endfor %}
              <li class="d-flex align-items-center justify-content-between">
                <strong class="text-uppercase small font-weight-bold">Total</strong>
                <span>${{ total_amount }}</span>
              </li>
            </ul>

            <!-- PAYMENT METHOD UNDER ORDER SUMMARY -->
            <div class="mt-4 p-3 border rounded bg-light">
              <h5 class="mb-3">Payment Method</h5>

              <div class="form-check mb-2">
                <input class="form-check-input" type="radio" name="payment_method" id="cod" value="COD" checked>
                <label class="form-check-label" for="cod">
                  Cash on Delivery
                </label>
              </div>

              <div class="form-check mb-2">
                <input class="form-check-input" type="radio" name="payment_method" id="qr" value="QR">
                <label class="form-check-label" for="qr">
                  Pay by QR Code
                </label>
              </div>

              <!-- QR CODE -->
              <div id="qr-box" style="display:none; margin-top:15px; text-align:center;">
                <p>Scan this QR code to pay</p>
                <img src="{% static 'D:\E-Commerce_Django\jewelryshop\static\img\QRcode.jpg' %}" 
                     alt="QR Payment" 
                     style="width:200px;border:1px solid #ddd;padding:10px;">
                <p class="text-muted small mt-2">
                  Please complete payment before placing your order.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<script>
  const qrBox = document.getElementById('qr-box');
  const radios = document.querySelectorAll('input[name="payment_method"]');

  radios.forEach(radio => {
    radio.addEventListener('change', () => {
      if (radio.value === 'QR' && radio.checked) {
        qrBox.style.display = 'block';
      } else {
        qrBox.style.display = 'none';
      }
    });
  });
</script>

{% endblock content %}
